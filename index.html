
<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  background: #f5f6fa;
}

.airport {
  fill: #000;
}


text {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 10px;
  pointer-events: none;
}

svg path.land {
  fill: #CCC;
}

.country {
  fill: #edeffa;
  stroke: #CCC;
}

.red {
  fill: #F00;
}

.none {
  opacity: 0.05;
}

.src {
  fill: #F00;
}

.country:hover {
  
}

.q0-9 { fill:#000000; }
.q1-9 { fill:#000642; }
.q2-9 { fill:#010a6b; }
.q3-9 { fill:#030e8a; }
.q4-9 { fill:#0210ab; }
.q5-9 { fill:#0213cc; }
.q6-9 { fill:#0014f2; }
.q7-9 { fill:#2638ff; }
.q8-9 { fill:#5c69fa; }

</style>
<body>
<script src="http://d3js.org/d3.v3.js"></script>
<script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
<script src="http://d3js.org/topojson.v0.min.js"></script>
<script src="geojson/geojson-utils.js"></script>
<script src="underscore.js"></script>
<script>

var minConnections = 0;

var airSpeed = 250; //meters/second
var airportDelay = 7200 //two hours in seconds

var maxDomain = 10000000/airSpeed;

var width = 1200,
    height = 800;

var projection = d3.geo.miller()
    .scale(150)
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection)
    .pointRadius(2);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var quantize = d3.scale.quantize()
    .domain([0, maxDomain])
    .range(d3.range(9).map(function(i) { return "q" + i + "-9"; }));

window.startingCity=null;

function planeTimeBetween(src,dest){
  return ( gju.pointDistance(src,dest) / airSpeed ) + airportDelay;
}

d3.json("data/world.json", function(error, world) {

  // draw countries
  svg.selectAll(".country")
    .data(topojson.object(world, world.objects.countries).geometries)
    .enter().append('path')
      .attr("d", path)
      .attr("class", "country")

});

function initializeDijkstras(links)
{
  for (var l in links)
  {
    links[l].prev=undefined;
    links[l].cost=Infinity;
  }
}

function dijkstras()
{
  links = window.airportLinks;
  //Dijkstra's Algotithm
  initializeDijkstras(links)

  //Set current node to cost 0
  links[d.airportID].cost=0;

  //Place all nodes in queue
  var Q = links;
  //Final set of nodes
  var nodes;

  //While queue is not empty
  while ( Q != {})
  {
    //u is node with smallest distance
    //If the Queue was sorted, you could just dequeue it here
    var u=_.min(Q,function(q){
      return q.cost
    })
    //remove u from Q
    delete Q.u;

    //If minimum cost is infinity, we have reached the end
    if (u.cost==Infinity)
      break;

    //Push u to final graph
    nodes.push(u);

    //For each neighbour v of u
    for (var i=0; i<u.cout.length;i++)
    {
      //v is one neighbour of u, v=[id,cost]
      var v = u.cout[i]
      //is v still in Q?
      vObj=Q[v[0]]
      if ( vObj != undefined )
      {
        //How much would it cost to go from u to v?
        var alt = u.cost + v[1]
        //Is this new cost lower than v's currnet cost?
        if ( alt < vObj.cost  )
        {
          //Set v's cost to the lower cost
          vObj.cost = alt;
          //Set the previous to u
          vObj.prev = u;
          //Put vObj into links, replace

          //If I were going to sort the Q, I would sort it here
        }
      }
    }
  }
  return nodes;
}

d3.json("data/original/airport.json", function(allAirports) {
  d3.csv("data/routes.csv", function(allRoutes) {
    
    window.airportById = {};
    window.airportLinks = {};

    for (var i=0;i<allAirports.features.length;i++){
      id = allAirports.features[i].properties.airportID;

      airportById[id] = allAirports.features[i];
      airportLinks[id] = {cin:[],cout:[],prev:undefined,cost:Infinity};
    }


    for (var i=0;i<allRoutes.length;i++)
    {
      var src = allRoutes[i].srcAirportID;
      var dest = allRoutes[i].destAirportID;
      
      if(src != "\\N" && dest != "\\N"){

        var time = planeTimeBetween(airportById[src],airportById[dest]);

        airportLinks[src].cout.push([dest,time]);
        airportLinks[dest].cin.push([src,time]);
      }
    }

    //Maybe this isn't needed
    for(var a in allAirports.features){
      var id = allAirports.features[a].properties.airportID;
      allAirports.features[a].properties.cin = airportLinks[id].cin;
      allAirports.features[a].properties.cout = airportLinks[id].cout;
    }


    var airports = svg.selectAll(".airport")
    .data(allAirports.features)
    .enter().append('path')
      .attr("d", path)
      .attr("class", "airport");

    //On click of an airport
    airports.on("click",function(d){

      dijkstras();



    });
  });
});






</script>


<!--

<body>
  <svg width=1200 height=800 class="numer of strings">
    <path d=path() class="place" /> data={}
  </svg>
</body>
-->